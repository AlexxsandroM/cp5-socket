# ====== STAGE 1: build ======
FROM maven:3.9.6-eclipse-temurin-17 AS build
WORKDIR /app
COPY . .
# compila e copia dependências para /app/target/deps
RUN mvn -q -DskipTests clean package dependency:copy-dependencies -DoutputDirectory=target/deps

# ====== STAGE 2: runtime ======
FROM eclipse-temurin:17-jdk-jammy
WORKDIR /app

# só o que precisamos para rodar mains à escolha:
# - classes compiladas
# - dependências (libs)
COPY --from=build /app/target/classes /app/classes
COPY --from=build /app/target/deps     /app/deps

# dica: cria usuário não-root (mais seguro)
RUN useradd -ms /bin/bash appuser
USER appuser

# nada de ENTRYPOINT fixo; a gente escolhe o main na linha de comando
# exemplo de execução:
#   java -cp /app/classes:/app/deps/* br.com.fiap.cp5_socket.Server
